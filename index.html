<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmSmart - Complete Farming Solution</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2d5016;
            --secondary: #7cb342;
            --light: #f1f8e9;
            --accent: #ff9800;
            --dark: #1a300c;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
        }
        
        body {
            background-color: #f9fdf5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            position: fixed;
top: 0;
left: 0;
width: 100%;
z-index: 1000;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 2.2rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        nav a {
            color: white;
            text-decoration: none;
            margin-left: 1.5rem;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        nav a:hover {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }
        
        /* Hero Section */
        .hero {
            padding: 4rem 0;
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            text-align: center;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
            color: #555;
        }
        
        /* Map Analysis Section */
        .map-analysis-section {
            padding: 2rem 0 0;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .section-header h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .section-header p {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Map & Location Side-by-Side Section */
        .map-location-section {
            padding: 2rem 0;
        }
        
        .map-location-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: stretch;
        }
        
        .map-wrapper {
            flex: 2;
            min-width: 300px;
        }
        
        .location-info-wrapper {
            flex: 1;
            min-width: 300px;
        }
        
        .map-container {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .map-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        /* Compact Location Information Card */
        .location-info-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            height: 500px; /* Match map height */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .location-info-card h3 {
            color: var(--primary);
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
            flex-shrink: 0;
        }
        
        .location-info-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* Compact Grid Layout */
        .location-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-bottom: 1.2rem;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 0.7rem;
            background: var(--light);
            border-radius: 8px;
            border-left: 3px solid var(--secondary);
            min-height: 70px;
            justify-content: center;
        }
        
        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 0.75rem;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.3;
            word-break: break-word;
        }
        
        /* Compact Address Section */
        .location-address {
            background-color: rgba(124, 179, 66, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid rgba(124, 179, 66, 0.3);
            flex-shrink: 0;
        }
        
        .address-line {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .address-line i {
            color: var(--secondary);
            width: 16px;
            font-size: 0.9rem;
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .address-text {
            flex: 1;
            line-height: 1.4;
        }
        
        .location-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: auto;
            padding-top: 1.2rem;
            border-top: 2px solid var(--light);
            flex-shrink: 0;
        }
        
        /* Weather & Analysis Dashboard */
        .dashboard-section {
            padding: 2rem 0;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .weather-icon {
            font-size: 3rem;
            color: var(--info);
        }
        
        .weather-details {
            flex: 1;
        }
        
        .weather-temp {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .weather-condition {
            color: #666;
            font-weight: 500;
        }
        
        .weather-forecast {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .forecast-day {
            text-align: center;
            padding: 0.8rem;
            background: var(--light);
            border-radius: 8px;
        }
        
        .forecast-day .day {
            font-weight: 600;
            color: var(--primary);
        }
        
        .forecast-day .temp {
            font-weight: 700;
            color: #333;
        }
        
        .analysis-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #eee;
        }
        
        .analysis-label {
            font-weight: 600;
            color: #666;
        }
        
        .analysis-value {
            font-weight: 700;
            color: var(--primary);
        }
        
        .progress-bar {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 5px;
        }
        
        /* Crop Advisory Section with Greenery Background */
        .crop-advisory-section {
            padding: 3rem 0;
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.9)), 
                        url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        
        .crop-advisory-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(45, 80, 22, 0.05) 0%, rgba(124, 179, 66, 0.05) 100%);
            z-index: 0;
        }
        
        .crop-advisory-section > .container {
            position: relative;
            z-index: 1;
        }
        
        .section-title {
            text-align: center;
            color: var(--primary);
            margin-bottom: 2rem;
            font-size: 2rem;
            position: relative;
        }
        
        .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background-color: var(--secondary);
            margin: 10px auto;
        }
        
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.8rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .col {
            flex: 1;
            min-width: 250px;
        }
        
        .risk-levels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .risk-option {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            margin: 0 5px;
            border: 2px solid #ddd;
        }
        
        .risk-option:hover {
            transform: translateY(-3px);
        }
        
        .risk-option.selected {
            border-color: var(--secondary);
            background-color: rgba(124, 179, 66, 0.1);
        }
        
        .risk-low {
            color: var(--success);
        }
        
        .risk-medium {
            color: var(--warning);
        }
        
        .risk-high {
            color: var(--danger);
        }
        
        .risk-option i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 0.9rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-small {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #45a049;
        }
        
        .btn-crop-advise {
            background-color: var(--accent);
        }
        
        .btn-crop-advise:hover {
            background-color: #f57c00;
        }
        
        /* Results Section */
        .results-section {
            padding: 3rem 0;
            display: none;
            background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.97)), 
                        url('https://images.unsplash.com/photo-1560493676-04071c5f467b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        
        .results-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(124, 179, 66, 0.05) 100%);
            z-index: 0;
        }
        
        .results-section > .container {
            position: relative;
            z-index: 1;
        }
        
        .results-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .crop-card {
            background-color: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--secondary);
        }
        
        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .crop-name {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }
        
        .profit-probability {
            background-color: var(--secondary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .crop-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 1.5rem;
        }
        
        .suggestion {
            background-color: rgba(255, 152, 0, 0.1);
            border-left: 5px solid var(--accent);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
        }
        
        .suggestion-title {
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        
        .risk-low-bg {
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .risk-medium-bg {
            background-color: rgba(255, 152, 0, 0.1);
        }
        
        .risk-high-bg {
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        /* Farming Tools Section */
        .tools-section {
            padding: 3rem 0;
            background-color: #f5f9f0;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .tool-card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .tool-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .tool-card h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }
        
        .tool-form {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        
        .tool-result {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            display: none;
        }
        
        .tool-result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .result-label {
            font-weight: 600;
            color: #666;
        }
        
        .result-value {
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 3rem 0 1.5rem;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
        }
        
        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1.2rem;
            color: var(--accent);
        }
        
        .footer-section p {
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        
        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .map-location-container {
                flex-direction: column;
            }
            
            .map-container, .location-info-card {
                height: 400px;
            }
            
            .location-info-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav {
                display: flex;
                gap: 15px;
            }
            
            nav a {
                margin-left: 0;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .map-container, .location-info-card {
                height: 350px;
            }
            
            .form-container, .results-container {
                padding: 1.5rem;
            }
            
            .crop-details {
                grid-template-columns: 1fr;
            }
            
            .risk-levels {
                flex-direction: column;
                gap: 10px;
            }
            
            .map-controls {
                bottom: 10px;
                left: 10px;
            }
            
            .weather-forecast {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .location-info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .location-actions {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .location-info-grid {
                grid-template-columns: 1fr;
            }
            
            .location-actions {
                flex-direction: column;
            }
        }
        
        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 5px solid var(--secondary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Location Permission Modal */
        .location-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-content h2 {
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .modal-content p {
            margin-bottom: 1.5rem;
            color: #555;
        }
        
        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* Current Location Dropdown */
        .current-location-option {
            background-color: rgba(124, 179, 66, 0.1);
            border-left: 3px solid var(--secondary);
            padding-left: 10px;
            font-weight: 600;
        }
        
        /* Auto-fill notification */
        .auto-fill-notice {
            background-color: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--accent);
            border-radius: 5px;
            padding: 6px 10px;
            margin-top: 8px;
            font-size: 0.8rem;
            color: #5d4037;
            display: none;
            line-height: 1.4;
        }
        
        .auto-fill-notice.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Map Location Info */
        .location-marker-popup {
            text-align: center;
            padding: 5px;
        }
        
        .location-marker-popup b {
            color: var(--primary);
        }
        
        /* Tool tabs */
        .tool-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .tool-tab {
            padding: 0.5rem 1.5rem;
            background: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #666;
        }
        
        .tool-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tool-content {
            display: none;
        }
        
        .tool-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Scrollbar styling */
        .location-info-content::-webkit-scrollbar {
            width: 5px;
        }
        
        .location-info-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .location-info-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        .location-info-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Location Permission Modal -->
    <div id="locationModal" class="location-modal">
        <div class="modal-content">
            <i class="fas fa-map-marker-alt" style="font-size: 3rem; color: var(--secondary); margin-bottom: 1rem;"></i>
            <h2>Share Your Location</h2>
            <p>To provide accurate crop recommendations, we need to know your location. This will help us analyze soil conditions, climate, and regional crop suitability.</p>
            <p>Your location data is secure and will only be used for crop advisory purposes.</p>
            <div class="modal-actions">
                <button id="allowLocation" class="btn">
                    <i class="fas fa-check-circle"></i> Allow Location Access
                </button>
                <button id="manualLocation" class="btn btn-outline">
                    <i class="fas fa-map-pin"></i> Enter Location Manually
                </button>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>Farm<span>Smart</span></h1>
            </div>
            <nav>
                <a href="#"><i class="fas fa-home"></i> Home</a>
                <a href="#location"><i class="fas fa-map-marker-alt"></i> Location</a>
                <a href="#cropAdvisory"><i class="fas fa-seedling"></i> Crop Advisory</a>
                <a href="#tools"><i class="fas fa-tools"></i> Farming Tools</a>
            </nav>
        </div>
    </header>
    <h1 style="color: white;">&nbsp </h1>
    <h1>&nbsp</h1>
    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Complete Farming Solution</h2>
            <p>Get personalized crop recommendations, weather forecasts, soil analysis, and farming tools to maximize your profits and minimize losses.</p>
            <a href="#location" class="btn"><i class="fas fa-play-circle"></i> Get Started</a>
        </div>
    </section>
    
    <!-- Map Analysis Section -->
    <section class="map-analysis-section">
        <div class="container">
            <div class="section-header">
                <h2><i class="fas fa-map-marked-alt"></i> Your Location Analysis</h2>
                <p>View your farm location on the map and get detailed location information for accurate crop recommendations.</p>
            </div>
        </div>
    </section>
    
    <!-- Map & Location Side-by-Side Section -->
    <section class="map-location-section" id="location">
        <div class="container">
            <div class="map-location-container">
                <!-- Left Side: Map -->
                <div class="map-wrapper">
                    <div class="map-container">
                        <div id="map"></div>
                        <div class="map-overlay">
                            <i class="fas fa-map"></i> Your Farm Location
                        </div>
                        <div class="map-controls">
                            <button id="locateMe" class="btn btn-small">
                                <i class="fas fa-crosshairs"></i> Locate Me
                            </button>
                            <button id="zoomIn" class="btn btn-small btn-outline">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button id="zoomOut" class="btn btn-small btn-outline">
                                <i class="fas fa-search-minus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side: Compact Location Information -->
                <div class="location-info-wrapper">
                    <div class="location-info-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Location Details</h3>
                        
                        <div class="location-info-content">
                            <div class="location-info-grid">
                                <div class="detail-item">
                                    <span class="detail-label">State</span>
                                    <span id="state" class="detail-value">---</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">District</span>
                                    <span id="district" class="detail-value">---</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Village/Town</span>
                                    <span id="village" class="detail-value">---</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Region</span>
                                    <span id="region" class="detail-value">---</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Coordinates</span>
                                    <span id="coordinates" class="detail-value">---</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Soil Type</span>
                                    <span id="soilTypeDisplay" class="detail-value">---</span>
                                </div>
                            </div>
                            
                            <div class="location-address">
                                <div class="address-line">
                                    <i class="fas fa-home"></i>
                                    <div class="address-text" id="addressLine1">Address details will appear here</div>
                                </div>
                                <div class="address-line">
                                    <i class="fas fa-landmark"></i>
                                    <div class="address-text" id="addressLine2">State and district information</div>
                                </div>
                                <div class="address-line">
                                    <i class="fas fa-globe-asia"></i>
                                    <div class="address-text" id="addressLine3">Region and soil type</div>
                                </div>
                            </div>
                            
                            <div class="auto-fill-notice" id="locationAutoFillNotice">
                                <i class="fas fa-lightbulb"></i> Location data will auto-fill the crop advisory form.
                            </div>
                        </div>
                        
                        <div class="location-actions">
                            <button id="cropAdviseBtn" class="btn btn-small btn-crop-advise">
                                <i class="fas fa-seedling"></i> Crop Advise
                            </button>
                            <button id="refreshLocation" class="btn btn-small">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button id="changeLocation" class="btn btn-small btn-outline">
                                <i class="fas fa-edit"></i> Change
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Weather & Analysis Dashboard -->
    <section class="dashboard-section">
        <div class="container">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-cloud-sun"></i> Weather Report</h3>
                    <div class="weather-info">
                        <div class="weather-icon">
                            <i class="fas fa-sun" id="weatherIcon"></i>
                        </div>
                        <div class="weather-details">
                            <div class="weather-temp" id="currentTemp">28¬∞C</div>
                            <div class="weather-condition" id="weatherCondition">Sunny</div>
                            <div id="weatherLocation">Detecting location...</div>
                        </div>
                    </div>
                    <div class="weather-forecast" id="weatherForecast">
                        <!-- Weather forecast will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-line"></i> Soil Analysis</h3>
                    <div class="analysis-item">
                        <span class="analysis-label">Soil Type</span>
                        <span class="analysis-value" id="soilTypeDash">---</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">pH Level</span>
                        <span class="analysis-value" id="soilPH">6.8 (Optimal)</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">Nutrient Level</span>
                        <span class="analysis-value" id="nutrientLevel">High</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">Moisture Content</span>
                        <span class="analysis-value" id="moistureContent">65%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%"></div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-alt"></i> Farming Calendar</h3>
                    <div class="analysis-item">
                        <span class="analysis-label">Current Season</span>
                        <span class="analysis-value" id="currentSeason">Kharif</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">Planting Window</span>
                        <span class="analysis-value" id="plantingWindow">Jun - Aug</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">Harvest Period</span>
                        <span class="analysis-value" id="harvestPeriod">Oct - Dec</span>
                    </div>
                    <div class="analysis-item">
                        <span class="analysis-label">Rainfall Probability</span>
                        <span class="analysis-value" id="rainfallProb">85%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Crop Advisory Section -->
    <section id="cropAdvisory" class="crop-advisory-section">
        <div class="container">
            <h2 class="section-title">Crop Advisory Input</h2>
            <div class="form-container">
                <form id="cropForm">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="locationSelect"><i class="fas fa-map-marker-alt"></i> Farm Location</label>
                                <select id="locationSelect" class="form-control" required>
                                    <option value="">Select your region</option>
                                    <option value="current-location" class="current-location-option">üìç Use My Current Location</option>
                                    <option value="north">Northern Region (Wheat, Rice, Sugarcane)</option>
                                    <option value="south">Southern Region (Rice, Cotton, Groundnut)</option>
                                    <option value="east">Eastern Region (Rice, Jute, Tea)</option>
                                    <option value="west">Western Region (Cotton, Bajra, Maize)</option>
                                    <option value="central">Central Region (Wheat, Soybean, Pulses)</option>
                                </select>
                                <div class="auto-fill-notice" id="locationNotice">
                                    <i class="fas fa-check-circle"></i> Location set from your current position. Soil type auto-filled.
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="lastCrop"><i class="fas fa-history"></i> Last Crop Grown</label>
                                <select id="lastCrop" class="form-control" required>
                                    <option value="">Select last crop</option>
                                    <option value="wheat">Wheat</option>
                                    <option value="rice">Rice</option>
                                    <option value="cotton">Cotton</option>
                                    <option value="sugarcane">Sugarcane</option>
                                    <option value="maize">Maize</option>
                                    <option value="pulses">Pulses</option>
                                    <option value="vegetables">Vegetables</option>
                                    <option value="fruits">Fruits</option>
                                    <option value="none">No crop (Fallow land)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="soilType"><i class="fas fa-mountain"></i> Soil Type</label>
                                <select id="soilType" class="form-control" required>
                                    <option value="">Select soil type</option>
                                    <option value="alluvial">Alluvial (Fertile)</option>
                                    <option value="black">Black (Clayey)</option>
                                    <option value="red">Red (Loamy)</option>
                                    <option value="laterite">Laterite (Acidic)</option>
                                    <option value="mountain">Mountain (Forest)</option>
                                </select>
                                <div class="auto-fill-notice" id="soilNotice">
                                    <i class="fas fa-check-circle"></i> Soil type auto-detected from your location.
                                </div>
                            </div>
                        </div>
                        
                        <div class="col">
                            <div class="form-group">
                                <label for="budget"><i class="fas fa-rupee-sign"></i> Budget (per acre)</label>
                                <select id="budget" class="form-control" required>
                                    <option value="">Select budget range</option>
                                    <option value="low">Low (‚Çπ10,000 - ‚Çπ25,000)</option>
                                    <option value="medium">Medium (‚Çπ25,000 - ‚Çπ50,000)</option>
                                    <option value="high">High (‚Çπ50,000 - ‚Çπ1,00,000)</option>
                                    <option value="very-high">Very High (‚Çπ1,00,000+)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label><i class="fas fa-chart-line"></i> Risk Tolerance</label>
                                <div class="risk-levels">
                                    <div class="risk-option risk-low" data-risk="low">
                                        <i class="fas fa-shield-alt"></i>
                                        <div>Low Risk</div>
                                        <small>Stable Returns</small>
                                    </div>
                                    <div class="risk-option risk-medium" data-risk="medium">
                                        <i class="fas fa-balance-scale"></i>
                                        <div>Medium Risk</div>
                                        <small>Balanced</small>
                                    </div>
                                    <div class="risk-option risk-high" data-risk="high">
                                        <i class="fas fa-bolt"></i>
                                        <div>High Risk</div>
                                        <small>High Potential</small>
                                    </div>
                                </div>
                                <input type="hidden" id="riskTolerance" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="cropPreference"><i class="fas fa-leaf"></i> Crop Preference (Optional)</label>
                                <select id="cropPreference" class="form-control">
                                    <option value="">Any crop</option>
                                    <option value="cereals">Cereals (Wheat, Rice, Maize)</option>
                                    <option value="cash">Cash Crops (Cotton, Sugarcane)</option>
                                    <option value="pulses">Pulses (Lentils, Chickpeas)</option>
                                    <option value="horticulture">Horticulture (Fruits, Vegetables)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="landArea"><i class="fas fa-vector-square"></i> Land Area (in acres)</label>
                        <input type="number" id="landArea" class="form-control" min="0.1" max="1000" step="0.1" placeholder="e.g., 5.5" required>
                    </div>
                    
                    <button type="submit" class="btn btn-block">
                        <i class="fas fa-calculator"></i> Analyze & Get Recommendations
                    </button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Analyzing data and generating crop recommendations...</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Results Section -->
    <section id="results" class="results-section">
        <div class="container">
            <h2 class="section-title">Crop Recommendations</h2>
            <div class="results-container">
                <div id="resultsContent">
                    <!-- Results will be inserted here by JavaScript -->
                </div>
                <button id="backToForm" class="btn">
                    <i class="fas fa-redo"></i> New Analysis
                </button>
            </div>
        </div>
    </section>
    
    <!-- Farming Tools Section -->
    <section id="tools" class="tools-section">
        <div class="container">
            <h2 class="section-title">Farming Tools & Calculators</h2>
            <div class="tools-grid">
                <div class="tool-card">
                    <h3><i class="fas fa-calculator"></i> Profit Calculator</h3>
                    <div class="tool-tabs">
                        <div class="tool-tab active" data-tab="profit">Calculate Profit</div>
                        <div class="tool-tab" data-tab="yield">Yield Estimator</div>
                    </div>
                    
                    <div class="tool-content active" id="profitTool">
                        <form class="tool-form" id="profitCalculator">
                            <div class="form-group">
                                <label for="cropTypeCalc">Crop Type</label>
                                <select id="cropTypeCalc" class="form-control" required>
                                    <option value="">Select crop</option>
                                    <option value="wheat">Wheat</option>
                                    <option value="rice">Rice</option>
                                    <option value="cotton">Cotton</option>
                                    <option value="sugarcane">Sugarcane</option>
                                    <option value="maize">Maize</option>
                                    <option value="vegetables">Vegetables</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="landAreaCalc">Land Area (acres)</label>
                                <input type="number" id="landAreaCalc" class="form-control" min="0.1" step="0.1" value="5" required>
                            </div>
                            <div class="form-group">
                                <label for="expectedYield">Expected Yield (kg/acre)</label>
                                <input type="number" id="expectedYield" class="form-control" min="1" value="2000" required>
                            </div>
                            <div class="form-group">
                                <label for="marketPrice">Market Price (‚Çπ/kg)</label>
                                <input type="number" id="marketPrice" class="form-control" min="1" value="25" required>
                            </div>
                            <div class="form-group">
                                <label for="costPerAcre">Cost per Acre (‚Çπ)</label>
                                <input type="number" id="costPerAcre" class="form-control" min="1" value="30000" required>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-calculator"></i> Calculate Profit
                            </button>
                        </form>
                        
                        <div class="tool-result" id="profitResult">
                            <h4>Profit Analysis</h4>
                            <div class="result-item">
                                <span class="result-label">Total Production:</span>
                                <span class="result-value" id="totalProduction">0 kg</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Revenue:</span>
                                <span class="result-value" id="totalRevenue">‚Çπ0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Cost:</span>
                                <span class="result-value" id="totalCost">‚Çπ0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Net Profit:</span>
                                <span class="result-value" id="netProfit">‚Çπ0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Profit per Acre:</span>
                                <span class="result-value" id="profitPerAcre">‚Çπ0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ROI (Return on Investment):</span>
                                <span class="result-value" id="roiPercentage">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tool-content" id="yieldTool">
                        <form class="tool-form" id="yieldEstimator">
                            <div class="form-group">
                                <label for="cropTypeYield">Crop Type</label>
                                <select id="cropTypeYield" class="form-control" required>
                                    <option value="">Select crop</option>
                                    <option value="wheat">Wheat</option>
                                    <option value="rice">Rice</option>
                                    <option value="cotton">Cotton</option>
                                    <option value="sugarcane">Sugarcane</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="seedQuality">Seed Quality</label>
                                <select id="seedQuality" class="form-control" required>
                                    <option value="high">High Quality</option>
                                    <option value="medium" selected>Medium Quality</option>
                                    <option value="low">Low Quality</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="irrigationType">Irrigation Type</label>
                                <select id="irrigationType" class="form-control" required>
                                    <option value="full">Full Irrigation</option>
                                    <option value="partial" selected>Partial Irrigation</option>
                                    <option value="rainfed">Rainfed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fertilizerUse">Fertilizer Usage</label>
                                <select id="fertilizerUse" class="form-control" required>
                                    <option value="high">High</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-chart-bar"></i> Estimate Yield
                            </button>
                        </form>
                        
                        <div class="tool-result" id="yieldResult">
                            <h4>Yield Estimation</h4>
                            <div class="result-item">
                                <span class="result-label">Expected Yield:</span>
                                <span class="result-value" id="estimatedYield">0 kg/acre</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Yield Potential:</span>
                                <span class="result-value" id="yieldPotential">Low</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Recommendations:</span>
                                <span class="result-value" id="yieldRecommendations">---</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tool-card">
                    <h3><i class="fas fa-tint"></i> Water Calculator</h3>
                    <form class="tool-form" id="waterCalculator">
                        <div class="form-group">
                            <label for="cropWater">Crop Type</label>
                            <select id="cropWater" class="form-control" required>
                                <option value="">Select crop</option>
                                <option value="rice">Rice (High Water)</option>
                                <option value="wheat">Wheat (Medium Water)</option>
                                <option value="cotton">Cotton (Medium Water)</option>
                                <option value="pulses">Pulses (Low Water)</option>
                                <option value="vegetables">Vegetables (High Water)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="waterLandArea">Land Area (acres)</label>
                            <input type="number" id="waterLandArea" class="form-control" min="0.1" step="0.1" value="5" required>
                        </div>
                        <div class="form-group">
                            <label for="growthStage">Growth Stage</label>
                            <select id="growthStage" class="form-control" required>
                                <option value="initial">Initial Stage</option>
                                <option value="development">Development Stage</option>
                                <option value="mid">Mid Season</option>
                                <option value="late">Late Season</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="soilMoisture">Current Soil Moisture (%)</label>
                            <input type="number" id="soilMoisture" class="form-control" min="0" max="100" value="60" required>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-calculator"></i> Calculate Water Needs
                        </button>
                    </form>
                    
                    <div class="tool-result" id="waterResult">
                        <h4>Water Requirements</h4>
                        <div class="result-item">
                            <span class="result-label">Daily Water Need:</span>
                            <span class="result-value" id="dailyWater">0 liters</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Weekly Water Need:</span>
                            <span class="result-value" id="weeklyWater">0 liters</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Seasonal Water Need:</span>
                            <span class="result-value" id="seasonalWater">0 liters</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Irrigation Frequency:</span>
                            <span class="result-value" id="irrigationFreq">---</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Water Saving Tips:</span>
                            <span class="result-value" id="waterTips">---</span>
                        </div>
                    </div>
                </div>
                
                <div class="tool-card">
                    <h3><i class="fas fa-seedling"></i> Fertilizer Calculator</h3>
                    <form class="tool-form" id="fertilizerCalculator">
                        <div class="form-group">
                            <label for="cropFertilizer">Crop Type</label>
                            <select id="cropFertilizer" class="form-control" required>
                                <option value="">Select crop</option>
                                <option value="wheat">Wheat</option>
                                <option value="rice">Rice</option>
                                <option value="cotton">Cotton</option>
                                <option value="maize">Maize</option>
                                <option value="vegetables">Vegetables</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fertLandArea">Land Area (acres)</label>
                            <input type="number" id="fertLandArea" class="form-control" min="0.1" step="0.1" value="5" required>
                        </div>
                        <div class="form-group">
                            <label for="soilTest">Soil Test Results</label>
                            <select id="soilTest" class="form-control" required>
                                <option value="low">Low Nutrients</option>
                                <option value="medium" selected>Medium Nutrients</option>
                                <option value="high">High Nutrients</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="previousCrop">Previous Crop</label>
                            <select id="previousCrop" class="form-control" required>
                                <option value="legume">Legume (Pulses)</option>
                                <option value="cereal">Cereal (Wheat/Rice)</option>
                                <option value="cash">Cash Crop (Cotton/Sugarcane)</option>
                                <option value="fallow">Fallow Land</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-calculator"></i> Calculate Fertilizer
                        </button>
                    </form>
                    
                    <div class="tool-result" id="fertilizerResult">
                        <h4>Fertilizer Recommendation</h4>
                        <div class="result-item">
                            <span class="result-label">Nitrogen (N):</span>
                            <span class="result-value" id="nitrogenAmount">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Phosphorus (P‚ÇÇO‚ÇÖ):</span>
                            <span class="result-value" id="phosphorusAmount">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Potassium (K‚ÇÇO):</span>
                            <span class="result-value" id="potassiumAmount">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Total Fertilizer:</span>
                            <span class="result-value" id="totalFertilizer">0 kg</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Application Timing:</span>
                            <span class="result-value" id="fertTiming">---</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Estimated Cost:</span>
                            <span class="result-value" id="fertCost">‚Çπ0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-seedling"></i> FarmSmart</h3>
                    <p>Empowering farmers with data-driven insights for better crop planning and increased profitability.</p>
                    <p><i class="fas fa-phone"></i> Farmer Helpline: 1800-XXX-XXXX</p>
                </div>
                
                <div class="footer-section">
                    <h3><i class="fas fa-link"></i> Quick Links</h3>
                    <p><a href="#cropAdvisory" style="color: white; text-decoration: none;">Crop Advisory</a></p>
                    <p><a href="#tools" style="color: white; text-decoration: none;">Farming Tools</a></p>
                    <p><a href="#location" style="color: white; text-decoration: none;">Location Analysis</a></p>
                </div>
                
                <div class="footer-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Contact</h3>
                    <p><i class="fas fa-envelope"></i> info@farmsmart.com</p>
                    <p><i class="fas fa-globe"></i> www.farmsmart.com</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 FarmSmart. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global variables
        let map;
        let userMarker;
        let userLocation = null;
        let currentDetectedRegion = null;
        let currentDetectedSoil = null;
        let currentLocationDetails = {
            state: '',
            district: '',
            village: '',
            region: '',
            coordinates: '',
            soilType: ''
        };
        
        // DOM Elements
        const locationModal = document.getElementById('locationModal');
        const allowLocationBtn = document.getElementById('allowLocation');
        const manualLocationBtn = document.getElementById('manualLocation');
        const refreshLocationBtn = document.getElementById('refreshLocation');
        const changeLocationBtn = document.getElementById('changeLocation');
        const locateMeBtn = document.getElementById('locateMe');
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const cropAdviseBtn = document.getElementById('cropAdviseBtn');
        
        // Location display elements
        const stateDisplay = document.getElementById('state');
        const districtDisplay = document.getElementById('district');
        const villageDisplay = document.getElementById('village');
        const regionDisplay = document.getElementById('region');
        const coordinatesDisplay = document.getElementById('coordinates');
        const soilTypeDisplay = document.getElementById('soilTypeDisplay');
        const addressLine1 = document.getElementById('addressLine1');
        const addressLine2 = document.getElementById('addressLine2');
        const addressLine3 = document.getElementById('addressLine3');
        
        // Dashboard elements
        const soilTypeDash = document.getElementById('soilTypeDash');
        const soilPH = document.getElementById('soilPH');
        const nutrientLevel = document.getElementById('nutrientLevel');
        const moistureContent = document.getElementById('moistureContent');
        const currentSeason = document.getElementById('currentSeason');
        const plantingWindow = document.getElementById('plantingWindow');
        const harvestPeriod = document.getElementById('harvestPeriod');
        const rainfallProb = document.getElementById('rainfallProb');
        const weatherIcon = document.getElementById('weatherIcon');
        const currentTemp = document.getElementById('currentTemp');
        const weatherCondition = document.getElementById('weatherCondition');
        const weatherLocation = document.getElementById('weatherLocation');
        const weatherForecast = document.getElementById('weatherForecast');
        
        // Form elements
        const locationSelect = document.getElementById('locationSelect');
        const soilTypeSelect = document.getElementById('soilType');
        const locationNotice = document.getElementById('locationNotice');
        const soilNotice = document.getElementById('soilNotice');
        const locationAutoFillNotice = document.getElementById('locationAutoFillNotice');
        
        // Tool elements
        const toolTabs = document.querySelectorAll('.tool-tab');
        const toolContents = document.querySelectorAll('.tool-content');
        
        const cropForm = document.getElementById('cropForm');
        const resultsSection = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        const resultsContent = document.getElementById('resultsContent');
        const backToFormBtn = document.getElementById('backToForm');
        const riskOptions = document.querySelectorAll('.risk-option');
        const riskInput = document.getElementById('riskTolerance');
        
        // India state and district data (simplified for demo)
        const indiaLocationData = {
            "north": {
                states: ["Uttar Pradesh", "Punjab", "Haryana", "Uttarakhand", "Himachal Pradesh", "Jammu & Kashmir", "Delhi"],
                districts: ["Lucknow", "Ludhiana", "Chandigarh", "Dehradun", "Shimla", "Srinagar", "New Delhi"],
                villages: ["Mohanpur", "Singhpur", "Rajpur", "Shivpur", "Ramnagar", "Krishnanagar", "Devnagar"],
                soilType: "Alluvial (Fertile)",
                soilCode: "alluvial",
                climate: "Subtropical",
                season: "Rabi",
                planting: "Oct - Nov",
                harvest: "Mar - Apr"
            },
            "south": {
                states: ["Tamil Nadu", "Kerala", "Karnataka", "Andhra Pradesh", "Telangana"],
                districts: ["Chennai", "Thiruvananthapuram", "Bengaluru", "Hyderabad", "Vijayawada"],
                villages: ["Madurai", "Kochi", "Mysore", "Tirupati", "Warangal"],
                soilType: "Red (Loamy)",
                soilCode: "red",
                climate: "Tropical",
                season: "Kharif",
                planting: "Jun - Jul",
                harvest: "Oct - Nov"
            },
            "east": {
                states: ["West Bengal", "Odisha", "Bihar", "Jharkhand", "Assam"],
                districts: ["Kolkata", "Bhubaneswar", "Patna", "Ranchi", "Guwahati"],
                villages: ["Howrah", "Puri", "Gaya", "Jamshedpur", "Dibrugarh"],
                soilType: "Alluvial (Fertile)",
                soilCode: "alluvial",
                climate: "Tropical Wet",
                season: "Kharif",
                planting: "Jun - Jul",
                harvest: "Sep - Oct"
            },
            "west": {
                states: ["Maharashtra", "Gujarat", "Rajasthan", "Goa", "Madhya Pradesh"],
                districts: ["Mumbai", "Ahmedabad", "Jaipur", "Panaji", "Bhopal"],
                villages: ["Pune", "Surat", "Udaipur", "Margao", "Indore"],
                soilType: "Black (Clayey)",
                soilCode: "black",
                climate: "Arid/Semi-Arid",
                season: "Kharif",
                planting: "Jun - Jul",
                harvest: "Sep - Oct"
            },
            "central": {
                states: ["Madhya Pradesh", "Chhattisgarh", "Uttar Pradesh (Central)"],
                districts: ["Bhopal", "Raipur", "Allahabad"],
                villages: ["Indore", "Bhilai", "Varanasi"],
                soilType: "Black (Clayey)",
                soilCode: "black",
                climate: "Tropical",
                season: "Kharif",
                planting: "Jun - Jul",
                harvest: "Sep - Oct"
            }
        };
        
        // Weather data based on region
        const weatherData = {
            "north": {
                temp: "24¬∞C",
                condition: "Partly Cloudy",
                icon: "fa-cloud-sun",
                forecast: [
                    {day: "Today", temp: "24¬∞C", icon: "fa-cloud-sun"},
                    {day: "Tomorrow", temp: "26¬∞C", icon: "fa-sun"},
                    {day: "Day 3", temp: "23¬∞C", icon: "fa-cloud-rain"}
                ]
            },
            "south": {
                temp: "30¬∞C",
                condition: "Sunny",
                icon: "fa-sun",
                forecast: [
                    {day: "Today", temp: "30¬∞C", icon: "fa-sun"},
                    {day: "Tomorrow", temp: "31¬∞C", icon: "fa-sun"},
                    {day: "Day 3", temp: "29¬∞C", icon: "fa-cloud-sun"}
                ]
            },
            "east": {
                temp: "28¬∞C",
                condition: "Rainy",
                icon: "fa-cloud-rain",
                forecast: [
                    {day: "Today", temp: "28¬∞C", icon: "fa-cloud-rain"},
                    {day: "Tomorrow", temp: "27¬∞C", icon: "fa-cloud-showers-heavy"},
                    {day: "Day 3", temp: "26¬∞C", icon: "fa-cloud-rain"}
                ]
            },
            "west": {
                temp: "32¬∞C",
                condition: "Clear",
                icon: "fa-sun",
                forecast: [
                    {day: "Today", temp: "32¬∞C", icon: "fa-sun"},
                    {day: "Tomorrow", temp: "33¬∞C", icon: "fa-sun"},
                    {day: "Day 3", temp: "31¬∞C", icon: "fa-cloud-sun"}
                ]
            },
            "central": {
                temp: "29¬∞C",
                condition: "Partly Cloudy",
                icon: "fa-cloud-sun",
                forecast: [
                    {day: "Today", temp: "29¬∞C", icon: "fa-cloud-sun"},
                    {day: "Tomorrow", temp: "30¬∞C", icon: "fa-sun"},
                    {day: "Day 3", temp: "28¬∞C", icon: "fa-cloud"}
                ]
            }
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Show location modal on page load
            locationModal.style.display = 'flex';
            
            // Initialize map
            initMap();
            
            // Set default land area
            document.getElementById('landArea').value = "5";
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize tool tabs
            initToolTabs();
        });
        
        // Initialize Leaflet map
        function initMap() {
            // Default center (India)
            map = L.map('map').setView([20.5937, 78.9629], 5);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add a default marker
            userMarker = L.marker([20.5937, 78.9629]).addTo(map)
                .bindPopup('<div class="location-marker-popup"><b>FarmSmart</b><br>Your location will be shown here</div>')
                .openPopup();
        }
        
        // Initialize tool tabs
        function initToolTabs() {
            toolTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs
                    toolTabs.forEach(t => t.classList.remove('active'));
                    toolContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.getElementById(`${tabId}Tool`).classList.add('active');
                });
            });
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Location modal buttons
            allowLocationBtn.addEventListener('click', getUserLocation);
            manualLocationBtn.addEventListener('click', showManualLocationInput);
            
            // Location action buttons
            refreshLocationBtn.addEventListener('click', getUserLocation);
            changeLocationBtn.addEventListener('click', () => {
                locationModal.style.display = 'flex';
            });
            
            // Crop advise button
            cropAdviseBtn.addEventListener('click', () => {
                // First try to get current location if not already done
                if (!userLocation) {
                    getUserLocation();
                }
                // Then scroll to crop advisory section
                setTimeout(() => {
                    document.getElementById('cropAdvisory').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            });
            
            // Map control buttons
            locateMeBtn.addEventListener('click', getUserLocation);
            zoomInBtn.addEventListener('click', () => map.zoomIn());
            zoomOutBtn.addEventListener('click', () => map.zoomOut());
            
            // Tool form submissions
            document.getElementById('profitCalculator').addEventListener('submit', calculateProfit);
            document.getElementById('yieldEstimator').addEventListener('submit', estimateYield);
            document.getElementById('waterCalculator').addEventListener('submit', calculateWater);
            document.getElementById('fertilizerCalculator').addEventListener('submit', calculateFertilizer);
            
            // Location dropdown change event
            locationSelect.addEventListener('change', function() {
                if (this.value === 'current-location' && userLocation) {
                    fillFormFromCurrentLocation();
                } else if (this.value && this.value !== 'current-location') {
                    hideAutoFillNotices();
                }
            });
            
            // Risk selection handler
            riskOptions.forEach(option => {
                option.addEventListener('click', function() {
                    riskOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    riskInput.value = this.getAttribute('data-risk');
                });
            });
            
            // Form submission handler
            cropForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const location = locationSelect.value === 'current-location' ? currentDetectedRegion : locationSelect.value;
                const lastCrop = document.getElementById('lastCrop').value;
                const soilType = soilTypeSelect.value;
                const budget = document.getElementById('budget').value;
                const riskTolerance = riskInput.value;
                const cropPreference = document.getElementById('cropPreference').value;
                const landArea = parseFloat(document.getElementById('landArea').value);
                
                // Validate form
                if (!location || !lastCrop || !soilType || !budget || !riskTolerance || !landArea) {
                    alert('Please fill all required fields');
                    return;
                }
                
                // Show loading animation
                loadingDiv.style.display = 'block';
                
                // Simulate API call/processing delay
                setTimeout(function() {
                    loadingDiv.style.display = 'none';
                    const recommendations = generateRecommendations(location, lastCrop, soilType, budget, riskTolerance, cropPreference, landArea);
                    displayResults(recommendations);
                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                }, 1500);
            });
            
            // Back to form button handler
            backToFormBtn.addEventListener('click', function() {
                resultsSection.style.display = 'none';
                cropForm.reset();
                riskOptions.forEach(opt => opt.classList.remove('selected'));
                riskInput.value = '';
                document.getElementById('cropAdvisory').scrollIntoView({ behavior: 'smooth' });
            });
        }
        
        // Get user's current location
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser");
                return;
            }
            
            // Show loading state
            stateDisplay.textContent = "Detecting...";
            districtDisplay.textContent = "---";
            villageDisplay.textContent = "---";
            
            // Request location
            navigator.geolocation.getCurrentPosition(
                // Success callback
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Update user location
                    userLocation = { lat, lng };
                    
                    // Update map and UI
                    updateMapWithLocation(lat, lng);
                    updateLocationDetails(lat, lng);
                    
                    // Update weather and dashboard
                    updateWeatherDashboard();
                    
                    // Auto-fill the form with current location
                    fillFormFromCurrentLocation();
                    
                    // Hide modal
                    locationModal.style.display = 'none';
                },
                // Error callback
                function(error) {
                    console.error("Error getting location:", error);
                    alert("Unable to retrieve your location. Please enter it manually.");
                    
                    // Show manual input option
                    showManualLocationInput();
                }
            );
        }
        
        // Show manual location input
        function showManualLocationInput() {
            const region = prompt("Please enter your region (Northern, Southern, Eastern, Western, Central):");
            
            if (region) {
                // Convert region to lowercase for matching
                const regionLower = region.toLowerCase();
                let lat, lng;
                
                // Set coordinates based on region
                if (regionLower.includes("north")) {
                    lat = 30.3753; lng = 78.0042; // Uttarakhand
                } else if (regionLower.includes("south")) {
                    lat = 13.0827; lng = 80.2707; // Tamil Nadu
                } else if (regionLower.includes("east")) {
                    lat = 22.5726; lng = 88.3639; // West Bengal
                } else if (regionLower.includes("west")) {
                    lat = 19.0760; lng = 72.8777; // Maharashtra
                } else if (regionLower.includes("central")) {
                    lat = 23.2599; lng = 77.4126; // Madhya Pradesh
                } else {
                    lat = 20.5937; lng = 78.9629; // Default India
                }
                
                // Update user location
                userLocation = { lat, lng };
                
                // Update map and UI
                updateMapWithLocation(lat, lng);
                updateLocationDetails(lat, lng, region);
                
                // Update weather and dashboard
                updateWeatherDashboard();
                
                // Auto-fill the form
                fillFormFromCurrentLocation();
                
                // Hide modal
                locationModal.style.display = 'none';
            }
        }
        
        // Update map with user location
        function updateMapWithLocation(lat, lng) {
            // Update map view
            map.setView([lat, lng], 12);
            
            // Remove previous marker
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            // Create custom icon for farm location
            const farmIcon = L.divIcon({
                html: '<div style="background-color: #7cb342; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"><i class="fas fa-tractor"></i></div>',
                className: 'farm-marker',
                iconSize: [40, 40],
                iconAnchor: [20, 40]
            });
            
            // Add new marker with custom icon
            userMarker = L.marker([lat, lng], {icon: farmIcon}).addTo(map)
                .bindPopup(`<div class="location-marker-popup"><b>Your Farm Location</b><br>Lat: ${lat.toFixed(4)}<br>Lng: ${lng.toFixed(4)}<br>${currentLocationDetails.village}, ${currentLocationDetails.district}</div>`)
                .openPopup();
            
            // Add a circle to show approximate area
            L.circle([lat, lng], {
                color: 'green',
                fillColor: '#7cb342',
                fillOpacity: 0.15,
                radius: 3000 // 3km radius
            }).addTo(map);
        }
        
        // Update location details in UI
        function updateLocationDetails(lat, lng, customRegion = null) {
            // Determine region based on coordinates
            let region, regionCode, soilType, soilCode, climateZone;
            
            if (customRegion) {
                region = customRegion;
                regionCode = getRegionCode(region);
            } else {
                // Simple region detection based on coordinates (India-specific)
                if (lat > 28) {
                    region = "Northern Region";
                    regionCode = "north";
                } else if (lat < 15) {
                    region = "Southern Region";
                    regionCode = "south";
                } else if (lng > 85) {
                    region = "Eastern Region";
                    regionCode = "east";
                } else if (lng < 75) {
                    region = "Western Region";
                    regionCode = "west";
                } else {
                    region = "Central Region";
                    regionCode = "central";
                }
            }
            
            // Get location data for the region
            const regionData = indiaLocationData[regionCode] || indiaLocationData.north;
            
            // Randomly select a location from the region data
            const randomIndex = Math.floor(Math.random() * regionData.states.length);
            
            // Update location details
            currentLocationDetails = {
                state: regionData.states[randomIndex],
                district: regionData.districts[randomIndex],
                village: regionData.villages[randomIndex],
                region: region,
                coordinates: `${lat.toFixed(4)}, ${lng.toFixed(4)}`,
                soilType: regionData.soilType,
                soilCode: regionData.soilCode,
                climate: regionData.climate,
                season: regionData.season,
                planting: regionData.planting,
                harvest: regionData.harvest
            };
            
            // Store detected region and soil for form filling
            currentDetectedRegion = regionCode;
            currentDetectedSoil = regionData.soilCode;
            
            // Update UI elements
            stateDisplay.textContent = currentLocationDetails.state;
            districtDisplay.textContent = currentLocationDetails.district;
            villageDisplay.textContent = currentLocationDetails.village;
            regionDisplay.textContent = currentLocationDetails.region;
            coordinatesDisplay.textContent = currentLocationDetails.coordinates;
            soilTypeDisplay.textContent = currentLocationDetails.soilType;
            
            // Update address lines
            addressLine1.textContent = `${currentLocationDetails.village}, ${currentLocationDetails.district}`;
            addressLine2.textContent = `${currentLocationDetails.state}, ${currentLocationDetails.region}`;
            addressLine3.textContent = `Soil: ${currentLocationDetails.soilType}, Climate: ${currentLocationDetails.climate}`;
            
            // Show auto-fill notice
            locationAutoFillNotice.classList.add('show');
        }
        
        // Update weather and dashboard
        function updateWeatherDashboard() {
            if (!currentDetectedRegion) return;
            
            // Update soil analysis
            soilTypeDash.textContent = currentLocationDetails.soilType;
            
            // Set soil pH based on soil type
            let soilPHValue, nutrientValue, moistureValue;
            switch(currentDetectedSoil) {
                case "alluvial":
                    soilPHValue = "6.5 - 7.5 (Optimal)";
                    nutrientValue = "High";
                    moistureValue = "70%";
                    break;
                case "black":
                    soilPHValue = "7.5 - 8.5 (Alkaline)";
                    nutrientValue = "Very High";
                    moistureValue = "75%";
                    break;
                case "red":
                    soilPHValue = "5.5 - 6.5 (Acidic)";
                    nutrientValue = "Medium";
                    moistureValue = "50%";
                    break;
                default:
                    soilPHValue = "6.8 (Optimal)";
                    nutrientValue = "Medium";
                    moistureValue = "65%";
            }
            
            soilPH.textContent = soilPHValue;
            nutrientLevel.textContent = nutrientValue;
            moistureContent.textContent = moistureValue;
            
            // Update farming calendar
            currentSeason.textContent = currentLocationDetails.season;
            plantingWindow.textContent = currentLocationDetails.planting;
            harvestPeriod.textContent = currentLocationDetails.harvest;
            
            // Set rainfall probability based on region
            let rainfallProbability;
            switch(currentDetectedRegion) {
                case "east": rainfallProbability = "90%"; break;
                case "south": rainfallProbability = "75%"; break;
                case "north": rainfallProbability = "60%"; break;
                case "west": rainfallProbability = "40%"; break;
                case "central": rainfallProbability = "55%"; break;
                default: rainfallProbability = "65%";
            }
            rainfallProb.textContent = rainfallProbability;
            
            // Update weather
            const weather = weatherData[currentDetectedRegion] || weatherData.north;
            weatherIcon.className = `fas ${weather.icon}`;
            currentTemp.textContent = weather.temp;
            weatherCondition.textContent = weather.condition;
            weatherLocation.textContent = `${currentLocationDetails.village}, ${currentLocationDetails.district}`;
            
            // Update weather forecast
            weatherForecast.innerHTML = '';
            weather.forecast.forEach(day => {
                const forecastDay = document.createElement('div');
                forecastDay.className = 'forecast-day';
                forecastDay.innerHTML = `
                    <div class="day">${day.day}</div>
                    <div class="temp">${day.temp}</div>
                    <div><i class="fas ${day.icon}"></i></div>
                `;
                weatherForecast.appendChild(forecastDay);
            });
        }
        
        // Get region code from region name
        function getRegionCode(regionName) {
            const regionLower = regionName.toLowerCase();
            if (regionLower.includes("north")) return "north";
            if (regionLower.includes("south")) return "south";
            if (regionLower.includes("east")) return "east";
            if (regionLower.includes("west")) return "west";
            if (regionLower.includes("central")) return "central";
            return "north"; // default
        }
        
        // Fill form with current location data
        function fillFormFromCurrentLocation() {
            if (!currentDetectedRegion || !currentDetectedSoil) return;
            
            // Set location dropdown to "Use My Current Location"
            locationSelect.value = "current-location";
            
            // Set soil type based on detected soil
            soilTypeSelect.value = currentDetectedSoil;
            
            // Show auto-fill notices
            locationNotice.classList.add('show');
            soilNotice.classList.add('show');
            
            // Scroll to form section
            setTimeout(() => {
                document.getElementById('cropAdvisory').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }
        
        // Hide auto-fill notices
        function hideAutoFillNotices() {
            locationNotice.classList.remove('show');
            soilNotice.classList.remove('show');
        }
        
        // Calculate profit function
        function calculateProfit(e) {
            e.preventDefault();
            
            const landArea = parseFloat(document.getElementById('landAreaCalc').value);
            const expectedYield = parseFloat(document.getElementById('expectedYield').value);
            const marketPrice = parseFloat(document.getElementById('marketPrice').value);
            const costPerAcre = parseFloat(document.getElementById('costPerAcre').value);
            
            // Calculations
            const totalProduction = landArea * expectedYield;
            const totalRevenue = totalProduction * marketPrice;
            const totalCost = landArea * costPerAcre;
            const netProfit = totalRevenue - totalCost;
            const profitPerAcre = netProfit / landArea;
            const roiPercentage = totalCost > 0 ? ((netProfit / totalCost) * 100).toFixed(1) : 0;
            
            // Update results
            document.getElementById('totalProduction').textContent = `${totalProduction.toLocaleString()} kg`;
            document.getElementById('totalRevenue').textContent = `‚Çπ${totalRevenue.toLocaleString()}`;
            document.getElementById('totalCost').textContent = `‚Çπ${totalCost.toLocaleString()}`;
            document.getElementById('netProfit').textContent = `‚Çπ${netProfit.toLocaleString()}`;
            document.getElementById('profitPerAcre').textContent = `‚Çπ${profitPerAcre.toLocaleString()}`;
            document.getElementById('roiPercentage').textContent = `${roiPercentage}%`;
            
            // Show result
            document.getElementById('profitResult').classList.add('show');
        }
        
        // Estimate yield function
        function estimateYield(e) {
            e.preventDefault();
            
            const cropType = document.getElementById('cropTypeYield').value;
            const seedQuality = document.getElementById('seedQuality').value;
            const irrigationType = document.getElementById('irrigationType').value;
            const fertilizerUse = document.getElementById('fertilizerUse').value;
            
            // Base yields for different crops (kg/acre)
            const baseYields = {
                "wheat": 2500,
                "rice": 3000,
                "cotton": 800,
                "sugarcane": 50000
            };
            
            let baseYield = baseYields[cropType] || 2000;
            
            // Adjust based on factors
            let multiplier = 1.0;
            if (seedQuality === "high") multiplier *= 1.2;
            if (seedQuality === "low") multiplier *= 0.8;
            
            if (irrigationType === "full") multiplier *= 1.3;
            if (irrigationType === "rainfed") multiplier *= 0.7;
            
            if (fertilizerUse === "high") multiplier *= 1.25;
            if (fertilizerUse === "low") multiplier *= 0.75;
            
            const estimatedYield = Math.round(baseYield * multiplier);
            
            // Determine yield potential
            let yieldPotential = "Medium";
            if (multiplier > 1.2) yieldPotential = "High";
            if (multiplier < 0.8) yieldPotential = "Low";
            
            // Recommendations
            let recommendations = "Maintain current practices.";
            if (seedQuality === "low") recommendations = "Use certified high-quality seeds.";
            if (irrigationType === "rainfed") recommendations = "Consider supplementary irrigation.";
            if (fertilizerUse === "low") recommendations = "Increase fertilizer application as per soil test.";
            
            // Update results
            document.getElementById('estimatedYield').textContent = `${estimatedYield.toLocaleString()} kg/acre`;
            document.getElementById('yieldPotential').textContent = yieldPotential;
            document.getElementById('yieldRecommendations').textContent = recommendations;
            
            // Show result
            document.getElementById('yieldResult').classList.add('show');
        }
        
        // Calculate water needs function
        function calculateWater(e) {
            e.preventDefault();
            
            const cropType = document.getElementById('cropWater').value;
            const landArea = parseFloat(document.getElementById('waterLandArea').value);
            const growthStage = document.getElementById('growthStage').value;
            const soilMoisture = parseFloat(document.getElementById('soilMoisture').value);
            
            // Base water requirements (liters/day/acre)
            const baseWater = {
                "rice": 25000,
                "wheat": 15000,
                "cotton": 18000,
                "pulses": 8000,
                "vegetables": 20000
            };
            
            let dailyBase = baseWater[cropType] || 12000;
            
            // Adjust based on growth stage
            let stageMultiplier = 1.0;
            switch(growthStage) {
                case "initial": stageMultiplier = 0.7; break;
                case "development": stageMultiplier = 1.1; break;
                case "mid": stageMultiplier = 1.3; break;
                case "late": stageMultiplier = 0.9; break;
            }
            
            // Adjust based on soil moisture
            let moistureMultiplier = 1.0;
            if (soilMoisture > 80) moistureMultiplier = 0.5;
            else if (soilMoisture > 60) moistureMultiplier = 0.7;
            else if (soilMoisture < 40) moistureMultiplier = 1.3;
            else if (soilMoisture < 20) moistureMultiplier = 1.5;
            
            const dailyWater = Math.round(dailyBase * stageMultiplier * moistureMultiplier * landArea);
            const weeklyWater = dailyWater * 7;
            const seasonalWater = dailyWater * 120; // Approx 120 day season
            
            // Irrigation frequency
            let irrigationFreq = "Every 3 days";
            if (cropType === "rice") irrigationFreq = "Daily";
            if (cropType === "pulses") irrigationFreq = "Every 5-7 days";
            
            // Water saving tips
            let waterTips = "Use drip irrigation for efficiency.";
            if (soilMoisture < 40) waterTips = "Increase irrigation frequency immediately.";
            if (cropType === "rice") waterTips = "Consider System of Rice Intensification (SRI) to save water.";
            
            // Update results
            document.getElementById('dailyWater').textContent = `${dailyWater.toLocaleString()} liters`;
            document.getElementById('weeklyWater').textContent = `${weeklyWater.toLocaleString()} liters`;
            document.getElementById('seasonalWater').textContent = `${seasonalWater.toLocaleString()} liters`;
            document.getElementById('irrigationFreq').textContent = irrigationFreq;
            document.getElementById('waterTips').textContent = waterTips;
            
            // Show result
            document.getElementById('waterResult').classList.add('show');
        }
        
        // Calculate fertilizer needs function
        function calculateFertilizer(e) {
            e.preventDefault();
            
            const cropType = document.getElementById('cropFertilizer').value;
            const landArea = parseFloat(document.getElementById('fertLandArea').value);
            const soilTest = document.getElementById('soilTest').value;
            const previousCrop = document.getElementById('previousCrop').value;
            
            // Base fertilizer requirements (kg/acre)
            const baseFertilizer = {
                "wheat": {N: 120, P: 60, K: 40},
                "rice": {N: 150, P: 70, K: 60},
                "cotton": {N: 100, P: 50, K: 50},
                "maize": {N: 140, P: 65, K: 55},
                "vegetables": {N: 80, P: 40, K: 60}
            };
            
            let base = baseFertilizer[cropType] || {N: 100, P: 50, K: 40};
            
            // Adjust based on soil test
            let soilMultiplier = 1.0;
            if (soilTest === "low") soilMultiplier = 1.3;
            if (soilTest === "high") soilMultiplier = 0.7;
            
            // Adjust based on previous crop
            if (previousCrop === "legume") soilMultiplier *= 0.9; // Less N needed after legumes
            if (previousCrop === "fallow") soilMultiplier *= 1.1; // More needed after fallow
            
            const nitrogen = Math.round(base.N * soilMultiplier * landArea);
            const phosphorus = Math.round(base.P * soilMultiplier * landArea);
            const potassium = Math.round(base.K * soilMultiplier * landArea);
            const totalFertilizer = nitrogen + phosphorus + potassium;
            
            // Application timing
            let fertTiming = "Split application: 50% basal, 25% at tillering, 25% at flowering";
            if (cropType === "vegetables") fertTiming = "Weekly foliar application recommended";
            if (cropType === "cotton") fertTiming = "Basal + 2 top dressings at square formation and boll development";
            
            // Estimated cost (‚Çπ/kg: N-30, P-25, K-20)
            const fertCost = (nitrogen * 30) + (phosphorus * 25) + (potassium * 20);
            
            // Update results
            document.getElementById('nitrogenAmount').textContent = `${nitrogen} kg`;
            document.getElementById('phosphorusAmount').textContent = `${phosphorus} kg`;
            document.getElementById('potassiumAmount').textContent = `${potassium} kg`;
            document.getElementById('totalFertilizer').textContent = `${totalFertilizer} kg`;
            document.getElementById('fertTiming').textContent = fertTiming;
            document.getElementById('fertCost').textContent = `‚Çπ${fertCost.toLocaleString()}`;
            
            // Show result
            document.getElementById('fertilizerResult').classList.add('show');
        }
        
        // Function to generate crop recommendations based on inputs
        function generateRecommendations(location, lastCrop, soilType, budget, riskTolerance, cropPreference, landArea) {
            // Crop database with properties
            const cropDatabase = {
                wheat: {
                    name: "Wheat",
                    suitableRegions: ["north", "central"],
                    suitableSoil: ["alluvial", "black"],
                    budgetLevel: "medium",
                    riskLevel: "low",
                    cropType: "cereals",
                    profitProbability: 85,
                    avgInvestment: 30000,
                    avgProfit: 45000,
                    season: "Rabi (Winter)",
                    waterReq: "Medium",
                    growthPeriod: "120-140 days"
                },
                rice: {
                    name: "Rice",
                    suitableRegions: ["north", "south", "east"],
                    suitableSoil: ["alluvial", "black"],
                    budgetLevel: "medium",
                    riskLevel: "medium",
                    cropType: "cereals",
                    profitProbability: 80,
                    avgInvestment: 35000,
                    avgProfit: 55000,
                    season: "Kharif (Monsoon)",
                    waterReq: "High",
                    growthPeriod: "150-180 days"
                },
                cotton: {
                    name: "Cotton",
                    suitableRegions: ["west", "south"],
                    suitableSoil: ["black", "red"],
                    budgetLevel: "high",
                    riskLevel: "high",
                    cropType: "cash",
                    profitProbability: 65,
                    avgInvestment: 60000,
                    avgProfit: 90000,
                    season: "Kharif (Monsoon)",
                    waterReq: "Medium",
                    growthPeriod: "160-180 days"
                },
                sugarcane: {
                    name: "Sugarcane",
                    suitableRegions: ["north", "south"],
                    suitableSoil: ["alluvial", "black"],
                    budgetLevel: "very-high",
                    riskLevel: "medium",
                    cropType: "cash",
                    profitProbability: 75,
                    avgInvestment: 90000,
                    avgProfit: 140000,
                    season: "Year-round",
                    waterReq: "High",
                    growthPeriod: "12-18 months"
                },
                maize: {
                    name: "Maize",
                    suitableRegions: ["north", "west", "central"],
                    suitableSoil: ["alluvial", "red"],
                    budgetLevel: "medium",
                    riskLevel: "medium",
                    cropType: "cereals",
                    profitProbability: 70,
                    avgInvestment: 25000,
                    avgProfit: 40000,
                    season: "Kharif (Monsoon)",
                    waterReq: "Medium",
                    growthPeriod: "90-100 days"
                },
                pulses: {
                    name: "Pulses (Lentils/Chickpeas)",
                    suitableRegions: ["central", "north"],
                    suitableSoil: ["alluvial", "red", "laterite"],
                    budgetLevel: "low",
                    riskLevel: "low",
                    cropType: "pulses",
                    profitProbability: 90,
                    avgInvestment: 15000,
                    avgProfit: 25000,
                    season: "Rabi (Winter)",
                    waterReq: "Low",
                    growthPeriod: "90-120 days"
                },
                vegetables: {
                    name: "Vegetables (Tomato/Onion)",
                    suitableRegions: ["north", "south", "east", "west", "central"],
                    suitableSoil: ["alluvial", "red", "black"],
                    budgetLevel: "medium",
                    riskLevel: "high",
                    cropType: "horticulture",
                    profitProbability: 60,
                    avgInvestment: 40000,
                    avgProfit: 70000,
                    season: "Year-round (depending on type)",
                    waterReq: "Medium-High",
                    growthPeriod: "60-90 days"
                },
                fruits: {
                    name: "Fruits (Mango/Citrus)",
                    suitableRegions: ["south", "west", "central"],
                    suitableSoil: ["red", "laterite", "alluvial"],
                    budgetLevel: "high",
                    riskLevel: "high",
                    cropType: "horticulture",
                    profitProbability: 55,
                    avgInvestment: 80000,
                    avgProfit: 150000,
                    season: "Perennial",
                    waterReq: "Medium",
                    growthPeriod: "3-5 years (for yield)"
                },
                soybean: {
                    name: "Soybean",
                    suitableRegions: ["central", "west"],
                    suitableSoil: ["black", "red"],
                    budgetLevel: "medium",
                    riskLevel: "medium",
                    cropType: "pulses",
                    profitProbability: 75,
                    avgInvestment: 28000,
                    avgProfit: 42000,
                    season: "Kharif (Monsoon)",
                    waterReq: "Medium",
                    growthPeriod: "100-120 days"
                },
                groundnut: {
                    name: "Groundnut",
                    suitableRegions: ["south", "west"],
                    suitableSoil: ["red", "laterite", "alluvial"],
                    budgetLevel: "low",
                    riskLevel: "low",
                    cropType: "cash",
                    profitProbability: 85,
                    avgInvestment: 20000,
                    avgProfit: 35000,
                    season: "Kharif (Monsoon)",
                    waterReq: "Low",
                    growthPeriod: "100-130 days"
                }
            };
            
            // Filter crops based on user inputs
            let filteredCrops = [];
            
            for (const cropKey in cropDatabase) {
                const crop = cropDatabase[cropKey];
                
                // Check if crop is suitable for the selected region
                if (!crop.suitableRegions.includes(location)) continue;
                
                // Check if crop is suitable for soil type
                if (!crop.suitableSoil.includes(soilType)) continue;
                
                // Check if crop matches budget level
                if (budget !== crop.budgetLevel) {
                    const budgetOrder = ["low", "medium", "high", "very-high"];
                    const userBudgetIndex = budgetOrder.indexOf(budget);
                    const cropBudgetIndex = budgetOrder.indexOf(crop.budgetLevel);
                    
                    // If crop budget is significantly higher than user budget, skip
                    if (cropBudgetIndex > userBudgetIndex + 1) continue;
                }
                
                // Check if crop matches risk tolerance
                if (riskTolerance === "low" && crop.riskLevel === "high") continue;
                if (riskTolerance === "medium" && crop.riskLevel === "high") {
                    crop.profitProbability = Math.max(crop.profitProbability - 15, 30);
                }
                
                // Check crop preference if specified
                if (cropPreference && crop.cropType !== cropPreference) continue;
                
                // Crop rotation check
                if (lastCrop === cropKey || (lastCrop === "wheat" && cropKey === "wheat")) {
                    crop.profitProbability = Math.max(crop.profitProbability - 10, 40);
                }
                
                // Add to filtered list
                filteredCrops.push(crop);
            }
            
            // Sort by profit probability (descending)
            filteredCrops.sort((a, b) => b.profitProbability - a.profitProbability);
            
            // Return top 3 recommendations
            return filteredCrops.slice(0, 3);
        }
        
        // Function to display results
        function displayResults(recommendations) {
            resultsSection.style.display = 'block';
            resultsContent.innerHTML = '';
            
            if (recommendations.length === 0) {
                resultsContent.innerHTML = `
                    <div class="crop-card">
                        <h3>No Suitable Crops Found</h3>
                        <p>Based on your inputs, we couldn't find crops that match all your criteria. Try adjusting your preferences (like budget or risk tolerance) for better results.</p>
                    </div>
                `;
                return;
            }
            
            recommendations.forEach((crop, index) => {
                let riskClass = '';
                if (crop.riskLevel === 'low') riskClass = 'risk-low-bg';
                else if (crop.riskLevel === 'medium') riskClass = 'risk-medium-bg';
                else if (crop.riskLevel === 'high') riskClass = 'risk-high-bg';
                
                let probColor = '';
                if (crop.profitProbability >= 80) probColor = 'var(--success)';
                else if (crop.profitProbability >= 60) probColor = 'var(--warning)';
                else probColor = 'var(--danger)';
                
                const cropCard = document.createElement('div');
                cropCard.className = `crop-card ${riskClass}`;
                cropCard.innerHTML = `
                    <div class="crop-header">
                        <div class="crop-name">${index + 1}. ${crop.name}</div>
                        <div class="profit-probability" style="background-color: ${probColor}">
                            ${crop.profitProbability}% Profit Probability
                        </div>
                    </div>
                    
                    <div class="crop-details">
                        <div class="detail-item">
                            <span class="detail-label">Risk Level</span>
                            <span class="detail-value" style="color: ${crop.riskLevel === 'low' ? 'var(--success)' : crop.riskLevel === 'medium' ? 'var(--warning)' : 'var(--danger)'}">
                                ${crop.riskLevel.charAt(0).toUpperCase() + crop.riskLevel.slice(1)}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Avg. Investment (per acre)</span>
                            <span class="detail-value">‚Çπ${crop.avgInvestment.toLocaleString()}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Avg. Profit (per acre)</span>
                            <span class="detail-value">‚Çπ${crop.avgProfit.toLocaleString()}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Growth Period</span>
                            <span class="detail-value">${crop.growthPeriod}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Water Requirement</span>
                            <span class="detail-value">${crop.waterReq}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Best Season</span>
                            <span class="detail-value">${crop.season}</span>
                        </div>
                    </div>
                    
                    <div class="suggestion">
                        <div class="suggestion-title">Our Suggestion:</div>
                        <p>${generateSuggestion(crop)}</p>
                    </div>
                `;
                
                resultsContent.appendChild(cropCard);
            });
            
            const summaryCard = document.createElement('div');
            summaryCard.className = 'crop-card';
            summaryCard.innerHTML = `
                <h3>Summary</h3>
                <p>Based on your inputs, we recommend <strong>${recommendations[0].name}</strong> as your primary crop choice with ${recommendations[0].profitProbability}% profit probability.</p>
                <p>Remember to consider local weather conditions, market prices, and consult with agricultural experts before finalizing your crop selection.</p>
            `;
            resultsContent.appendChild(summaryCard);
        }
        
        // Function to generate crop-specific suggestions
        function generateSuggestion(crop) {
            const suggestions = {
                wheat: "Wheat is a stable choice with consistent market demand. Ensure proper irrigation during growth stages and consider government procurement options.",
                rice: "Rice requires good water management. Consider System of Rice Intensification (SRI) techniques for higher yield with less water.",
                cotton: "Cotton has high profit potential but is susceptible to pest attacks. Implement integrated pest management practices.",
                sugarcane: "Sugarcane is a long-term crop with good returns. Consider contract farming with sugar mills for assured market.",
                maize: "Maize has multiple uses (food, feed, industrial). Consider hybrid varieties for higher yield.",
                pulses: "Pulses improve soil fertility through nitrogen fixation. They have good government support and stable prices.",
                vegetables: "Vegetables offer quick returns but require careful market timing. Consider greenhouse cultivation for off-season produce.",
                fruits: "Fruit cultivation is long-term but highly profitable once established. Consider intercropping with short-term crops initially.",
                soybean: "Soybean is a good rotation crop that improves soil health. Has growing demand in food processing industry.",
                groundnut: "Groundnut is drought-resistant and suitable for rainfed areas. Good for oil extraction and direct consumption markets."
            };
            
            return suggestions[crop.name.toLowerCase().split(' ')[0]] || "This crop is suitable for your conditions. Consult local agricultural officers for specific cultivation practices.";
        }
    </script>
</body>
</html>
